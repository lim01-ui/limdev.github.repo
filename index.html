<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TOSNHAM - Food Delivery</title>
  <link rel="icon" type="image/png" href="favicon.png" />

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Animated gradient background */
    body {
      position: relative;
      background: none !important; /* Remove previous gradient */
    }
    @keyframes gradientBG {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }
    /* Custom scrollbar for food list */
    .food-list::-webkit-scrollbar {
      height: 8px;
    }i want
    .food-list::-webkit-scrollbar-thumb {
      background-color: #4f46e5; /* Indigo */
      border-radius: 4px;
    }
    /* Dark theme overrides */
    .dark body {
      background-color: #121212;
      color: #e4e4e7;
    }
    .dark header {
      background-color: #1f2937;
      box-shadow: 0 2px 4px rgba(255 255 255 / 0.05);
    }
    .dark .food-card {
      background-color: #1f2937;
      box-shadow: 0 0 12px rgba(255 255 255 / 0.05);
    }
    .dark .food-card:hover {
      box-shadow: 0 8px 20px rgba(255 255 255 / 0.1);
    }
    .dark input, .dark textarea, .dark select {
      background-color: #374151;
      border-color: #4b5563;
      color: #e4e4e7;
    }
    .dark input::placeholder {
      color: #9ca3af;
    }
    .dark .modal {
      background-color: #1f2937;
      color: #e4e4e7;
      border-color: #4b5563;
      box-shadow: 0 0 20px rgba(255 255 255 / 0.1);
    }
    /* Smooth fade for modal */
    .modal {
      transition: opacity 0.3s ease;
    }

    .animated-tosnham {
      background: linear-gradient(270deg, #0f172a, #312e81, #6366f1, #0ea5e9, #0f172a);
      background-size: 200% 200%;
      color: transparent;
      background-clip: text;
      -webkit-background-clip: text;
      animation: tosnham-blue-gradient 4s ease-in-out infinite, tosnham-pop 1.2s cubic-bezier(.68,-0.55,.27,1.55) 1;
      font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
      letter-spacing: 0.09em;
      text-shadow: 0 2px 12px rgba(49,46,129,0.18), 0 1px 0 #fff;
      position: relative;
      z-index: 1;
    }
    @keyframes tosnham-blue-gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes tosnham-pop {
      0% { transform: scale(0.8); opacity: 0; }
      60% { transform: scale(1.15); opacity: 1; }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body class="text-gray-800 transition-colors duration-500">

  <!-- MAP AND DELIVERY ANIMATION (NEWLY ADDED) -->
  <div class="fixed inset-0 -z-10 pointer-events-none">
    <!-- Google Maps-style background (replace the URL with your own map screenshot if you want) -->
    <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1920&q=80"
      alt="Map background"
      class="w-full h-full object-cover blur-[2px] brightness-90" />
    <!-- Canvas for animated delivery guys, now full width and height -->
    <canvas id="delivery-canvas"
      width="1600"
      height="700"
      class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full"
      style="pointer-events:none; max-width:100vw; max-height:100vh;">
    </canvas>
  </div>

  <script>
  // filepath: d:\school\make website\MyFoodApp\index.html
  // Replace your animateDeliveryGuys() function with this version
  // This will animate delivery guys riding to a customer, stopping, "delivering" food, then looping

  // Improved: Delivery guys and customer are now fully visible and positioned professionally in the upper third of the screen.

  (function animateDeliveryGuys() {
    const canvas = document.getElementById('delivery-canvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');

    // Responsive resize
    function resizeCanvas() {
      const dpr = window.devicePixelRatio || 1;
      const width = window.innerWidth;
      const height = window.innerHeight;
      canvas.width = width * dpr;
      canvas.height = height * dpr;
      canvas.style.width = width + "px";
      canvas.style.height = height + "px";
      ctx.setTransform(1, 0, 0, 1, 0, 0);
      ctx.scale(dpr, dpr);
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // Get the position of the search bar in the viewport
    function getSearchBarRect() {
      const searchBar = document.getElementById('search-input');
      if (!searchBar) {
        // Fallback to top 20% if not found
        return {
          left: window.innerWidth * 0.15,
          right: window.innerWidth * 0.85,
          top: window.innerHeight * 0.13,
          height: 56
        };
      }
      const rect = searchBar.getBoundingClientRect();
      // Adjust for scroll position
      return {
        left: rect.left,
        right: rect.right,
        top: rect.top,
        height: rect.height
      };
    }

    // Route: from left of search bar to right of search bar, with a slight arc
    function getRoutePoint(t) {
      const searchRect = getSearchBarRect();
      const y = searchRect.top + searchRect.height / 2 + 20; // 20px below center of search bar
      const startX = searchRect.left - 100;
      const endX = searchRect.right + 60;
      const cpY = y - 60; // Arc height
      const cpX = (startX + endX) / 2;
      // Quadratic Bezier
      const x = Math.pow(1-t,2)*startX + 2*(1-t)*t*cpX + Math.pow(t,2)*endX;
      const y2 = Math.pow(1-t,2)*y + 2*(1-t)*t*cpY + Math.pow(t,2)*y;
      return {x, y: y2};
    }

    // Delivery guy colors
    const guys = [
      { color: "#6366f1", helmet: "#6366f1", bike: "#6366f1", delay: 0 },
      { color: "#22d3ee", helmet: "#22d3ee", bike: "#22d3ee", delay: 2.5 },
      { color: "#f59e42", helmet: "#f59e42", bike: "#f59e42", delay: 5 }
    ];

    // Customer position (just right of search bar)
    function getCustomerPos() {
      const searchRect = getSearchBarRect();
      const x = searchRect.right + 100;
      const y = searchRect.top + searchRect.height / 2 + 20;
      return {x, y};
    }

    function drawMotorbikeGuy(ctx, x, y, color, helmet, bikeColor, givingFood = false) {
      // Shadow
      ctx.save();
      ctx.globalAlpha = 0.13;
      ctx.beginPath();
      ctx.ellipse(x, y + 32, 38, 12, 0, 0, 2 * Math.PI);
      ctx.fillStyle = "#000";
      ctx.fill();
      ctx.globalAlpha = 1;
      ctx.restore();

      // --- Motorbike ---
      // Wheels
      ctx.save();
      ctx.lineWidth = 5;
      ctx.strokeStyle = "#222";
      ctx.beginPath();
      ctx.arc(x - 28, y + 24, 16, 0, 2 * Math.PI);
      ctx.arc(x + 28, y + 24, 16, 0, 2 * Math.PI);
      ctx.stroke();
      ctx.restore();

      // Bike body
      ctx.save();
      ctx.lineWidth = 8;
      ctx.strokeStyle = bikeColor;
      ctx.beginPath();
      ctx.moveTo(x - 20, y + 18);
      ctx.lineTo(x + 20, y + 18);
      ctx.stroke();
      ctx.restore();

      // Bike seat
      ctx.save();
      ctx.lineWidth = 10;
      ctx.strokeStyle = "#444";
      ctx.beginPath();
      ctx.moveTo(x - 5, y + 10);
      ctx.lineTo(x + 10, y + 10);
      ctx.stroke();
      ctx.restore();

      // Handlebar
      ctx.save();
      ctx.lineWidth = 4;
      ctx.strokeStyle = "#444";
      ctx.beginPath();
      ctx.moveTo(x + 20, y + 18);
      ctx.lineTo(x + 32, y + 4);
      ctx.stroke();
      ctx.restore();

      // --- Rider ---
      // Body
      ctx.save();
      ctx.fillStyle = color;
      ctx.fillRect(x - 8, y - 10, 16, 28);
      ctx.restore();

      // Head
      ctx.save();
      ctx.beginPath();
      ctx.arc(x, y - 16, 10, 0, 2 * Math.PI);
      ctx.fillStyle = "#fde68a";
      ctx.strokeStyle = color;
      ctx.lineWidth = 2;
      ctx.fill();
      ctx.stroke();
      ctx.restore();

      // Helmet
      ctx.save();
      ctx.beginPath();
      ctx.ellipse(x, y - 22, 10, 5, 0, 0, 2 * Math.PI);
      ctx.fillStyle = helmet;
      ctx.fill();
      ctx.restore();

      // Arm (normal or giving food)
      ctx.save();
      ctx.strokeStyle = color;
      ctx.lineWidth = 5;
      ctx.beginPath();
      ctx.moveTo(x + 2, y); // shoulder
      if (givingFood) {
        ctx.lineTo(x + 38, y - 10); // hand out to customer
      } else {
        ctx.lineTo(x + 24, y + 8); // hand on handlebar
      }
      ctx.stroke();
      ctx.restore();

      // Delivery box
      ctx.save();
      ctx.fillStyle = "#fbbf24";
      ctx.fillRect(x - 28, y - 8, 18, 18);
      ctx.strokeStyle = "#b45309";
      ctx.lineWidth = 2;
      ctx.strokeRect(x - 28, y - 8, 18, 18);
      ctx.restore();

      // Food bag (show only when givingFood)
      if (givingFood) {
        ctx.save();
        ctx.beginPath();
        ctx.arc(x + 44, y - 10, 8, 0, 2 * Math.PI);
        ctx.fillStyle = "#fbbf24";
        ctx.fill();
        ctx.strokeStyle = "#b45309";
        ctx.lineWidth = 2;
        ctx.stroke();
        ctx.restore();
        // Handle
        ctx.save();
        ctx.beginPath();
        ctx.arc(x + 44, y - 16, 5, Math.PI, 2 * Math.PI);
        ctx.strokeStyle = "#b45309";
        ctx.lineWidth = 2;
        ctx.stroke();
        ctx.restore();
      }
    }

    function drawCustomer(ctx, x, y, receiving = false) {
      // Shadow
      ctx.save();
      ctx.globalAlpha = 0.10;
      ctx.beginPath();
      ctx.ellipse(x, y + 32, 22, 8, 0, 0, 2 * Math.PI);
      ctx.fillStyle = "#000";
      ctx.fill();
      ctx.globalAlpha = 1;
      ctx.restore();

      // Body
      ctx.save();
      ctx.fillStyle = "#10b981";
      ctx.fillRect(x - 8, y - 10, 16, 28);
      ctx.restore();

      // Head
      ctx.save();
      ctx.beginPath();
      ctx.arc(x, y - 16, 10, 0, 2 * Math.PI);
      ctx.fillStyle = "#fde68a";
      ctx.strokeStyle = "#10b981";
      ctx.lineWidth = 2;
      ctx.fill();
      ctx.stroke();
      ctx.restore();

      // Arm (reaching out if receiving)
      ctx.save();
      ctx.strokeStyle = "#10b981";
      ctx.lineWidth = 5;
      ctx.beginPath();
      ctx.moveTo(x - 2, y); // shoulder
      if (receiving) {
        ctx.lineTo(x - 38, y - 10); // reaching out to delivery guy
      } else {
        ctx.lineTo(x - 24, y + 8); // relaxed
      }
      ctx.stroke();
      ctx.restore();

      // Legs
      ctx.save();
      ctx.strokeStyle = "#166534";
      ctx.lineWidth = 6;
      // Left leg
      ctx.beginPath();
      ctx.moveTo(x - 4, y + 18);
      ctx.lineTo(x - 8, y + 36);
      ctx.stroke();
      // Right leg
      ctx.beginPath();
      ctx.moveTo(x + 4, y + 18);
      ctx.lineTo(x + 8, y + 36);
      ctx.stroke();
      ctx.restore();
    }

    function drawRoute(ctx) {
      const searchRect = getSearchBarRect();
      const y = searchRect.top + searchRect.height / 2 + 20;
      const startX = searchRect.left - 100;
      const endX = searchRect.right + 60;
      const cpY = y - 60;
      const cpX = (startX + endX) / 2;
      ctx.save();
      ctx.strokeStyle = "#6366f1";
      ctx.lineWidth = 18;
      ctx.setLineDash([32, 24]);
      ctx.beginPath();
      ctx.moveTo(startX, y);
      ctx.quadraticCurveTo(cpX, cpY, endX, y);
      ctx.stroke();
      ctx.setLineDash([]);
      ctx.restore();
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawRoute(ctx);

      // Draw customer at end of route (right of search bar)
      const customerPos = getCustomerPos();
      let receiving = false;

      const now = performance.now() / 1000;
      guys.forEach((guy, i) => {
        // Each guy: ride (0-80%), deliver (80-100%), then loop
        let t = ((now - guy.delay) % 8) / 8;
        if (t < 0) t += 1;
        // Ease in-out for more natural movement
        t = 0.5 - 0.5 * Math.cos(Math.PI * t);

        let givingFood = false;
        if (t > 0.8) {
          givingFood = true;
          receiving = true;
        }
        const pos = getRoutePoint(Math.min(t, 1));
        drawMotorbikeGuy(ctx, pos.x, pos.y, guy.color, guy.helmet, guy.bike, givingFood);
      });

      // Draw customer (receiving if any guy is delivering)
      drawCustomer(ctx, customerPos.x, customerPos.y - 8, receiving);

      requestAnimationFrame(animate);
    }

    animate();
  })();
  </script>

  <!-- HEADER -->
  <header class="flex justify-between items-center p-4 bg-white shadow-md dark:bg-gray-800 dark:shadow-none">
    <div class="flex items-center gap-2">
      <img src="logo.png" alt="Food Logo" class="w-10 h-10 object-cover rounded-full border-2 border-indigo-500 shadow" />
      <span class="animated-tosnham text-2xl font-extrabold cursor-default select-none tracking-wide">
        TOSNHAM
      </span>
    </div>
    <nav class="flex items-center gap-2">
      <button id="theme-toggle" aria-label="Toggle Dark Mode" title="Toggle Dark Mode" class="px-3 py-1 rounded-md hover:bg-indigo-100 dark:hover:bg-indigo-900 transition">
        🌙
      </button>
      <a href="#" id="settings-link" class="hidden md:inline text-gray-600 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400 transition">Settings</a>
      <a href="#" id="login-link" class="text-indigo-600 font-semibold hover:underline">Login</a>
      <a href="#" id="signup-link" class="text-indigo-600 font-semibold hover:underline">Register</a>
    </nav>
  </header>

  <!-- MAIN CONTENT -->
  <main class="max-w-7xl mx-auto p-4">

    <!-- Search bar -->
    <div class="mb-8 max-w-xl mx-auto relative">
      <input type="text" id="search-input" autocomplete="off" placeholder="Search for food, restaurants..." class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400" />
      <ul id="search-suggestions" class="absolute left-0 right-0 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-b-md shadow z-10 hidden max-h-48 overflow-y-auto"></ul>
    </div>

    <!-- Category filter (newly added) -->
    <div class="flex justify-center gap-4 mb-8">
      <button class="category-btn flex flex-col items-center focus:outline-none" data-category="all">
        <span class="w-12 h-12 flex items-center justify-center rounded-full bg-indigo-100 text-indigo-600 text-2xl shadow hover:bg-indigo-200 transition"><span>🍽️</span></span>
        <span class="text-xs mt-1 font-semibold text-indigo-700">All</span>
      </button>
      <button class="category-btn flex flex-col items-center focus:outline-none" data-category="fastfood">
        <span class="w-12 h-12 flex items-center justify-center rounded-full bg-yellow-100 text-yellow-600 text-2xl shadow hover:bg-yellow-200 transition"><span>🍔</span></span>
        <span class="text-xs mt-1 font-semibold text-yellow-700">Fast Food</span>
      </button>
      <button class="category-btn flex flex-col items-center focus:outline-none" data-category="drink">
        <span class="w-12 h-12 flex items-center justify-center rounded-full bg-blue-100 text-blue-600 text-2xl shadow hover:bg-blue-200 transition"><span>🥤</span></span>
        <span class="text-xs mt-1 font-semibold text-blue-700">Drinks</span>
      </button>
      <button class="category-btn flex flex-col items-center focus:outline-none" data-category="khmer">
        <span class="w-12 h-12 flex items-center justify-center rounded-full bg-green-100 text-green-600 text-2xl shadow hover:bg-green-200 transition"><span>🍲</span></span>
        <span class="text-xs mt-1 font-semibold text-green-700">Khmer Food</span>
      </button>
    </div>

    <!-- Food list -->
    <div id="food-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">

      <!-- Food cards will be injected dynamically -->

    </div>

  </main>

  <!-- MODALS -->

  <!-- Auth Modal -->
  <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center p-4 hidden z-50">
    <div class="modal bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-md w-full p-6 relative">
      <button id="auth-close-btn" aria-label="Close Auth Modal" class="absolute top-3 right-3 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white text-xl font-bold">&times;</button>
      <h2 id="modal-title" class="text-2xl font-bold mb-4 text-indigo-600">Login</h2>
      <form id="auth-form" class="space-y-4">
        <input type="email" id="auth-email" required placeholder="Email" class="w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100" />
        <input type="text" id="auth-username" placeholder="Username (required for Register)" class="w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 hidden" />
        <input type="password" id="auth-password" required placeholder="Password" class="w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100" />
        <button type="submit" id="auth-submit-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-md font-semibold transition">Login</button>
      </form>
      <p id="switch-auth" class="mt-4 text-center text-gray-600 dark:text-gray-400">
        Don't have an account? <span id="switch-auth-span" class="text-indigo-600 cursor-pointer font-semibold hover:underline">Sign Up</span>
      </p>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center p-4 hidden z-50">
    <div class="modal bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-2xl w-full p-6 relative overflow-y-auto max-h-[90vh]">
      <button id="settings-close-btn" aria-label="Close Settings Modal" class="absolute top-3 right-3 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white text-xl font-bold">&times;</button>
      <h2 class="text-3xl font-bold mb-6 text-indigo-600">Settings & Profile</h2>

      <!-- CEO Message -->
      <div id="ceo-message" class="mb-6 p-4 bg-indigo-50 dark:bg-indigo-900 rounded-md text-indigo-800 dark:text-indigo-200 font-semibold text-center">
        Venglim is <span class="text-indigo-600 dark:text-indigo-300 font-bold">the Chief Executive Officer (CEO)</span> of TOSNHAM.<br>
        With a strong commitment to innovation and customer satisfaction, we provide the best service in TOSNHAM with a vision to revolutionize food delivery. Under his guidance, the platform has grown to become a trusted name in the industry, focusing on quality, speed, and user experience.<br>
        Venglim's leadership ensures that TOSNHAM remains at the forefront of technology and service excellence, making sure that <span class="text-indigo-600 dark:text-indigo-300 font-bold">every user enjoys a smooth, reliable, and rewarding experience.</span> TOSNHAM's vision is to make food delivery not just a service, but a delightful journey for every customer.
      </div>

      <section id="profile-section" class="mb-8">
        <h3 class="text-xl font-semibold mb-4">User Profile</h3>
        <form id="profile-form" class="space-y-4 max-w-md">
          <div>
            <label for="profile-username" class="block font-medium mb-1">Username</label>
            <input type="text" id="profile-username" class="w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100" required />
          </div>
          <div>
            <label for="profile-email" class="block font-medium mb-1">Email</label>
            <input type="email" id="profile-email" class="w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100" required />
          </div>
          <div>
            <label for="profile-password" class="block font-medium mb-1">New Password</label>
            <input type="password" id="profile-password" placeholder="Leave blank to keep current password" class="w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100" />
          </div>
          <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-6 rounded-md font-semibold transition">Save Changes</button>
        </form>
      </section>

      <section id="policy-section">
        <h3 class="text-xl font-semibold mb-4">Privacy Policy</h3>
        <div class="text-gray-700 dark:text-gray-300 max-h-48 overflow-y-auto border border-gray-300 dark:border-gray-600 p-4 rounded-md text-sm leading-relaxed">
          <p><strong>Privacy Policy</strong></p>
          <p>Your privacy is important to us. We collect your data only to provide better service. We do not share your data with third parties without your consent.</p>
          <p>By using TOSNHAM, you agree to our terms and conditions and privacy practices.</p>
          <p>If you have any questions, please contact support@VenglimCEOTOSNHAM.com.</p>
        </div>
      </section>
    </div>
  </div>

  <!-- Add this just before </body> for the animated order estimate popup -->
  <div id="order-estimate-popup" class="fixed bottom-6 right-6 z-50 hidden">
    <div class="flex items-center gap-3 px-5 py-3 rounded-lg shadow-lg bg-white dark:bg-gray-800 border border-indigo-200 dark:border-indigo-700 animate-slide-in">
      <svg id="order-estimate-spinner" class="animate-spin h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
      </svg>
      <span id="order-estimate-text" class="text-indigo-700 dark:text-indigo-200 font-semibold text-base">
        Estimate: 4-6 mins
      </span>
    </div>
  </div>

  <style>
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(40px);}
      to { opacity: 1; transform: translateY(0);}
    }
    .animate-slide-in {
      animation: slideIn 0.5s cubic-bezier(.4,2,.6,1) both;
    }
  </style>

  <!-- SCRIPTS -->
  <script>
    (() => {
      "use strict";

      // Initial data: food items
      const foodItems = [
        // Fast Food
        {
          name: "Deluxe Burger",
          img: "https://images.pexels.com/photos/1639565/pexels-photo-1639565.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Juicy grilled burger with fresh lettuce, tomato, cheese, and special sauce.",
          category: "fastfood",
          price: 4.99
        },
        {
          name: "Italian Pizza",
          img: "https://images.pexels.com/photos/32318594/pexels-photo-32318594.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Classic thin-crust pizza topped with mozzarella, basil, and tomatoes.",
          category: "fastfood",
          price: 6.99
        },
        {
          name: "Fried Chicken",
          img: "https://images.pexels.com/photos/461382/pexels-photo-461382.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Crispy fried chicken with secret spices.",
          category: "fastfood",
          price: 3.99
        },
        {
          name: "Cheese Fries",
          img: "https://images.pexels.com/photos/1580466/pexels-photo-1580466.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Golden fries topped with melted cheese.",
          category: "fastfood",
          price: 2.49
        },
        {
          name: "Hot Dog",
          img: "https://images.pexels.com/photos/461382/pexels-photo-461382.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Classic hot dog with ketchup and mustard.",
          category: "fastfood",
          price: 2.99
        },
        // Drink
        {
          name: "Iced Coffee",
          img: "https://images.pexels.com/photos/302902/pexels-photo-302902.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Refreshing iced coffee with milk.",
          category: "drink",
          price: 1.99
        },
        {
          name: "Fruit Smoothie",
          img: "https://images.pexels.com/photos/461382/pexels-photo-461382.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Mixed fruit smoothie, healthy and delicious.",
          category: "drink",
          price: 2.49
        },
        {
          name: "Lemonade",
          img: "https://images.pexels.com/photos/96974/pexels-photo-96974.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Freshly squeezed lemonade.",
          category: "drink",
          price: 1.49
        },
        {
          name: "Milk Tea",
          img: "https://images.pexels.com/photos/461382/pexels-photo-461382.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Sweet milk tea with boba pearls.",
          category: "drink",
          price: 2.99
        },
        {
          name: "Coconut Juice",
          img: "https://images.pexels.com/photos/461382/pexels-photo-461382.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Chilled coconut juice, straight from the shell.",
          category: "drink",
          price: 1.99
        },
        // Khmer Food
        {
          name: "Fish Amok",
          img: "https://images.pexels.com/photos/461382/pexels-photo-461382.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Traditional Khmer steamed fish curry.",
          category: "khmer",
          price: 5.99
        },
        {
          name: "Bai Sach Chrouk",
          img: "https://images.pexels.com/photos/461382/pexels-photo-461382.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Grilled pork with rice, a Khmer breakfast favorite.",
          category: "khmer",
          price: 3.49
        },
        {
          name: "Nom Banh Chok",
          img: "https://images.pexels.com/photos/461382/pexels-photo-461382.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Khmer noodles with green curry gravy.",
          category: "khmer",
          price: 2.99
        },
        {
          name: "Lok Lak",
          img: "https://images.pexels.com/photos/461382/pexels-photo-461382.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Stir-fried beef with pepper sauce and rice.",
          category: "khmer",
          price: 4.49
        },
        {
          name: "Samlor Korko",
          img: "https://images.pexels.com/photos/461382/pexels-photo-461382.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Hearty Khmer vegetable stew.",
          category: "khmer",
          price: 3.99
        }
      ];

      // Elements
      const foodListEl = document.getElementById("food-list");
      const searchInput = document.getElementById("search-input");
      const themeToggleBtn = document.getElementById("theme-toggle");
      const loginLink = document.getElementById("login-link");
      const signupLink = document.getElementById("signup-link");
      const authModal = document.getElementById("auth-modal");
      const authCloseBtn = document.getElementById("auth-close-btn");
      const modalTitle = document.getElementById("modal-title");
      const authForm = document.getElementById("auth-form");
      const authEmail = document.getElementById("auth-email");
      const authUsername = document.getElementById("auth-username");
      const authPassword = document.getElementById("auth-password");
      const authSubmitBtn = document.getElementById("auth-submit-btn");
      const switchAuth = document.getElementById("switch-auth");
      const switchAuthSpan = document.getElementById("switch-auth-span");
      const settingsLink = document.getElementById("settings-link");
      const settingsModal = document.getElementById("settings-modal");
      const settingsCloseBtn = document.getElementById("settings-close-btn");

      const profileSection = document.getElementById("profile-section");
      const profileForm = document.getElementById("profile-form");
      const profileUsername = document.getElementById("profile-username");
      const profileEmail = document.getElementById("profile-email");
      const profilePassword = document.getElementById("profile-password");

      const suggestionsEl = document.getElementById("search-suggestions");

      // State
      let darkMode = false;
      let isLoginMode = true; // true: login, false: register
      let currentUser = null;

      // LOCAL STORAGE KEYS
      const STORAGE_USERS = "tosnham_users";
      const STORAGE_CURRENT_USER = "tosnham_current_user";
      const STORAGE_DARK_MODE = "tosnham_dark_mode";

      // --- UTILITIES ---

      // Get users from local storage
      function getUsers() {
        const usersJSON = localStorage.getItem(STORAGE_USERS);
        return usersJSON ? JSON.parse(usersJSON) : [];
      }

      // Save users to local storage
      function saveUsers(users) {
        localStorage.setItem(STORAGE_USERS, JSON.stringify(users));
      }

      // Save current user to local storage
      function saveCurrentUser(user) {
        if(user) localStorage.setItem(STORAGE_CURRENT_USER, JSON.stringify(user));
        else localStorage.removeItem(STORAGE_CURRENT_USER);
      }

      // Load current user from local storage
      function loadCurrentUser() {
        const userJSON = localStorage.getItem(STORAGE_CURRENT_USER);
        if(userJSON) return JSON.parse(userJSON);
        return null;
      }

      // Save dark mode preference
      function saveDarkMode(enabled) {
        localStorage.setItem(STORAGE_DARK_MODE, enabled ? "true" : "false");
      }

      // Load dark mode preference
      function loadDarkMode() {
        return localStorage.getItem(STORAGE_DARK_MODE) === "true";
      }

      // --- THEME ---

      function applyDarkMode(enabled) {
        darkMode = enabled;
        if(darkMode) {
          document.documentElement.classList.add("dark");
          themeToggleBtn.textContent = "☀️";
        } else {
          document.documentElement.classList.remove("dark");
          themeToggleBtn.textContent = "🌙";
        }
        saveDarkMode(darkMode);
      }

      themeToggleBtn.addEventListener("click", () => {
        applyDarkMode(!darkMode);
      });

      // --- RENDER FOOD LIST ---

      function createFoodCard(food) {
        const card = document.createElement("div");
        card.className = "food-card bg-white rounded-lg shadow-md hover:shadow-xl transition p-4 flex flex-col dark:bg-gray-700";
        card.innerHTML = `
          <img src="${food.img}" alt="${food.name}" loading="lazy" class="rounded-md mb-3 object-cover w-full h-40" />
          <h3 class="text-lg font-semibold mb-1">${food.name}</h3>
          <p class="text-gray-600 dark:text-gray-300 text-sm flex-grow">${food.desc}</p>
          <div class="flex items-center justify-between mt-3">
            <span class="text-indigo-600 font-bold text-lg">$${food.price.toFixed(2)}</span>
            <button class="order-btn bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-1 rounded-md font-semibold transition flex items-center gap-1" data-food='${JSON.stringify(food)}'>
              <span class="text-lg">🛒</span> Order
            </button>
          </div>
          <button class="add-more-btn mt-2 bg-gray-200 hover:bg-gray-300 text-gray-700 px-3 py-1 rounded-md text-sm font-medium transition flex items-center gap-1">
            <span class="text-lg">➕</span> Add More
          </button>
          <div class="order-estimate mt-2 hidden text-green-600 font-semibold text-sm flex items-center gap-1">
            <span class="text-lg">⏱️</span> Estimate: 4-6 mins
          </div>
        `;
        // Order button event
        card.querySelector(".order-btn").addEventListener("click", (e) => {
          e.stopPropagation();
          // Show animated popup at bottom right
          const popup = document.getElementById("order-estimate-popup");
          const spinner = document.getElementById("order-estimate-spinner");
          const text = document.getElementById("order-estimate-text");
          text.textContent = `Estimate: 4-6 mins`;
          spinner.classList.remove("hidden");
          popup.classList.remove("hidden");
          // Hide after 4 seconds, show "Order is being prepared!" after 2s
          setTimeout(() => {
            text.textContent = "Order is being prepared!";
            spinner.classList.add("hidden");
            setTimeout(() => {
              popup.classList.add("hidden");
              spinner.classList.remove("hidden");
            }, 2000);
          }, 2000);
          // You can add your order logic here
        });
        // Add More button event
        card.querySelector(".add-more-btn").addEventListener("click", (e) => {
          e.stopPropagation();
          alert(`Added more of: ${food.name}`);
          // You can add your add-more logic here
        });
        // Card click (optional: show details)
        card.addEventListener("click", () => {
          localStorage.setItem("tosnham_selected_food", JSON.stringify(food));
          window.location.href = "food.html";
        });
        return card;
      }

      function renderFoodList(filterText = "", category = "all") {
        foodListEl.innerHTML = "";
        const filter = filterText.trim().toLowerCase();
        let filteredFoods = foodItems.filter(f =>
          (f.name.toLowerCase().includes(filter) ||
            f.desc.toLowerCase().includes(filter))
        );
        if (category !== "all") {
          filteredFoods = filteredFoods.filter(f => f.category === category);
        }
        if (filteredFoods.length === 0) {
          foodListEl.innerHTML = `<p class="text-center col-span-full text-gray-500 dark:text-gray-400">No foods found.</p>`;
          return;
        }
        filteredFoods.forEach(food => {
          foodListEl.appendChild(createFoodCard(food));
        });
      }

      // --- AUTHENTICATION ---

      // Show auth modal: mode "login" or "register"
      function showAuthModal(mode = "login") {
        isLoginMode = (mode === "login");
        modalTitle.textContent = isLoginMode ? "Login" : "Register";
        authSubmitBtn.textContent = isLoginMode ? "Login" : "Register";
        authUsername.style.display = isLoginMode ? "none" : "block";
        switchAuthSpan.textContent = isLoginMode ? "Sign Up" : "Login";
        authEmail.value = "";
        authPassword.value = "";
        authUsername.value = "";
        authModal.classList.remove("hidden");
        authEmail.focus();
      }

      // Hide auth modal
      function hideAuthModal() {
        authModal.classList.add("hidden");
      }

      // Show settings modal
      function showSettingsModal() {
        if(!currentUser) {
          alert("You must be logged in to access Settings.");
          showAuthModal("login");
          return;
        }
        // Load profile data into form
        profileUsername.value = currentUser.username;
        profileEmail.value = currentUser.email;
        profilePassword.value = "";
        settingsModal.classList.remove("hidden");
      }

      // Hide settings modal
      function hideSettingsModal() {
        settingsModal.classList.add("hidden");
      }

      // Login handler
      function loginUser(email, password) {
        const users = getUsers();
        const user = users.find(u => u.email.toLowerCase() === email.toLowerCase());
        if(!user) {
          alert("User with this email does not exist.");
          return false;
        }
        if(user.password !== password) {
          alert("Incorrect password.");
          return false;
        }
        currentUser = user;
        saveCurrentUser(currentUser);
        updateUIForUser();
        return true;
      }

      // Register handler
      function registerUser(username, email, password) {
        let users = getUsers();
        // Check if email already exists
        if(users.some(u => u.email.toLowerCase() === email.toLowerCase())) {
          alert("Email is already registered.");
          return false;
        }
        if(users.some(u => u.username.toLowerCase() === username.toLowerCase())) {
          alert("Username is already taken.");
          return false;
        }
        // Add new user
        const newUser = { username, email, password };
        users.push(newUser);
        saveUsers(users);
        currentUser = newUser;
        saveCurrentUser(currentUser);
        updateUIForUser();
        return true;
      }

      // Logout handler
      function logoutUser() {
        currentUser = null;
        saveCurrentUser(null);
        updateUIForUser();
      }

      // Update UI based on current user login status
      function updateUIForUser() {
        if(currentUser) {
          loginLink.textContent = `Logout (${currentUser.username})`;
          loginLink.href = "#";
          signupLink.style.display = "none";
          settingsLink.style.display = "inline";
        } else {
          loginLink.textContent = "Login";
          loginLink.href = "#";
          signupLink.style.display = "inline";
          settingsLink.style.display = "none";
        }
      }

      // --- EVENTS ---

      // Show login modal on login link click
      loginLink.addEventListener("click", e => {
        e.preventDefault();
        if(currentUser) {
          if(confirm("Do you want to logout?")) {
            logoutUser();
          }
        } else {
          showAuthModal("login");
        }
      });

      // Show register modal on register link click
      signupLink.addEventListener("click", e => {
        e.preventDefault();
        showAuthModal("register");
      });

      authCloseBtn.addEventListener("click", () => {
        hideAuthModal();
      });

      authForm.addEventListener("submit", e => {
        e.preventDefault();
        const email = authEmail.value.trim();
        const password = authPassword.value;
        if(isLoginMode) {
          if(loginUser(email, password)) {
            hideAuthModal();
          }
        } else {
          const username = authUsername.value.trim();
          if(username.length < 3) {
            alert("Username must be at least 3 characters.");
            return;
          }
          if(registerUser(username, email, password)) {
            hideAuthModal();
          }
        }
      });

      switchAuthSpan.addEventListener("click", () => {
        showAuthModal(isLoginMode ? "register" : "login");
      });

      settingsLink.addEventListener("click", e => {
        e.preventDefault();
        showSettingsModal();
      });

      settingsCloseBtn.addEventListener("click", () => {
        hideSettingsModal();
      });

      // Save profile changes
      profileForm.addEventListener("submit", e => {
        e.preventDefault();
        if(!currentUser) {
          alert("Not logged in.");
          hideSettingsModal();
          return;
        }
        const newUsername = profileUsername.value.trim();
        const newEmail = profileEmail.value.trim();
        const newPassword = profilePassword.value;

        if(newUsername.length < 3) {
          alert("Username must be at least 3 characters.");
          return;
        }
        if(!newEmail.includes("@")) {
          alert("Please enter a valid email.");
          return;
        }

        // Check for duplicates (excluding current user)
        let users = getUsers();
        if(users.some(u => u.email.toLowerCase() === newEmail.toLowerCase() && u.email.toLowerCase() !== currentUser.email.toLowerCase())) {
          alert("Email already used by another user.");
          return;
        }
        if(users.some(u => u.username.toLowerCase() === newUsername.toLowerCase() && u.username.toLowerCase() !== currentUser.username.toLowerCase())) {
          alert("Username already taken.");
          return;
        }

        // Update user in local storage
        users = users.map(u => {
          if(u.email.toLowerCase() === currentUser.email.toLowerCase()) {
            return {
              username: newUsername,
              email: newEmail,
              password: newPassword.length > 0 ? newPassword : u.password
            };
          }
          return u;
        });
        saveUsers(users);
        currentUser = users.find(u => u.email.toLowerCase() === newEmail.toLowerCase());
        saveCurrentUser(currentUser);
        updateUIForUser();
        alert("Profile updated successfully.");
        hideSettingsModal();
      });

      // CATEGORY ICON CLICK HANDLER
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.addEventListener('click', function () {
          // Remove highlight from all buttons
          document.querySelectorAll('.category-btn').forEach(b => {
            b.classList.remove('ring-2', 'ring-indigo-500');
          });
          // Highlight the clicked button
          btn.classList.add('ring-2', 'ring-indigo-500');

          // Get category and render food list
          const cat = btn.getAttribute('data-category');
          renderFoodList("", cat || "all");
        });
      });

      // OPTIONAL: On page load, highlight "All" and show all foods
      document.addEventListener("DOMContentLoaded", () => {
        const allBtn = document.querySelector('.category-btn[data-category="all"]');
        if (allBtn) allBtn.classList.add('ring-2', 'ring-indigo-500');
        renderFoodList();
      });

      // Place this after your DOMContentLoaded or after defining renderFoodList

      // Helper: get unique food names and keywords
      function getFoodKeywords() {
        const keywords = new Set();
        foodItems.forEach(f => {
          keywords.add(f.name);
          f.desc.split(/\s+/).forEach(word => {
            if (word.length > 2) keywords.add(word.replace(/[^\w]/g, ""));
          });
        });
        return Array.from(keywords);
      }

      const foodKeywords = getFoodKeywords();

      searchInput.addEventListener("input", e => {
        const value = e.target.value.trim().toLowerCase();
        renderFoodList(value, document.querySelector(".category-btn.ring-2")?.getAttribute("data-category") || "all");

        // Suggestion logic
        if (value.length === 0) {
          suggestionsEl.classList.add("hidden");
          suggestionsEl.innerHTML = "";
          return;
        }
        const matches = foodKeywords.filter(k => k.toLowerCase().includes(value)).slice(0, 6);
        if (matches.length === 0) {
          suggestionsEl.classList.add("hidden");
          suggestionsEl.innerHTML = "";
          return;
        }
        suggestionsEl.innerHTML = matches.map(k => `<li class="px-4 py-2 cursor-pointer hover:bg-indigo-100 dark:hover:bg-indigo-800">${k}</li>`).join("");
        suggestionsEl.classList.remove("hidden");
      });

      // Click suggestion to fill input and search
      suggestionsEl.addEventListener("click", e => {
        if (e.target.tagName === "LI") {
          const keyword = e.target.textContent.trim();
          searchInput.value = keyword;
          suggestionsEl.classList.add("hidden");
          // Find the food item with this name (case-insensitive)
          const food = foodItems.find(f => f.name.toLowerCase() === keyword.toLowerCase());
          if (food) {
            // If it's a food name, filter by exact name
            renderFoodList(food.name, document.querySelector(".category-btn.ring-2")?.getAttribute("data-category") || "all");
          } else {
            // Otherwise, search as a keyword
            renderFoodList(keyword, document.querySelector(".category-btn.ring-2")?.getAttribute("data-category") || "all");
          }
        }
      });

      // Hide suggestions when input loses focus (with slight delay for click)
      searchInput.addEventListener("blur", () => setTimeout(() => suggestionsEl.classList.add("hidden"), 150));
      searchInput.addEventListener("focus", () => {
        if (searchInput.value.trim().length > 0 && suggestionsEl.innerHTML !== "") {
          suggestionsEl.classList.remove("hidden");
        }
      });

      // INITIAL SETUP
      function init() {
        // Render initial food list
        renderFoodList();

        // Load dark mode preference
        applyDarkMode(loadDarkMode());

        // Load current user if any
        currentUser = loadCurrentUser();
        updateUIForUser();
      }

      init();

    })();
  </script>

  <!-- FOOTER -->
  <footer class="w-full text-center py-4 bg-indigo-600 text-white border-t border-indigo-700 mt-8">
    &copy; 2025 TOSNHAM. All rights reserved. Led by CEO Venglim, TOSNHAM is committed to excellence, innovation, and delivering the highest quality service to our users.
  </footer>
</body>
</html>
